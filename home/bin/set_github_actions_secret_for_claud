#!/bin/bash
set -euo pipefail

if [[ $# -ne 1 ]]; then
  echo "Usage: $0 <GitHubリポジトリ名（例: bannzai/DigitalDetox）>"
  exit 1
fi

GITHUB_REPOSITORY="$1"

if [[ -z "${CLAUDE_SECRET_JSON:-}" ]]; then
  echo "CLAUDE_SECRET_JSON環境変数にJSON文字列をセットしてください"
  exit 1
fi

ACCESS_TOKEN=$(echo "$CLAUDE_SECRET_JSON" | jq -r '.claudeAiOauth.accessToken')
REFRESH_TOKEN=$(echo "$CLAUDE_SECRET_JSON" | jq -r '.claudeAiOauth.refreshToken')
EXPIRES_AT=$(echo "$CLAUDE_SECRET_JSON" | jq -r '.claudeAiOauth.expiresAt')

gh secret set CLAUDE_ACCESS_TOKEN --repo "$GITHUB_REPOSITORY" --body "$ACCESS_TOKEN"
gh secret set CLAUDE_REFRESH_TOKEN --repo "$GITHUB_REPOSITORY" --body "$REFRESH_TOKEN"
gh secret set CLAUDE_EXPIRES_AT --repo "$GITHUB_REPOSITORY" --body "$EXPIRES_AT"

echo "Secrets updated successfully."
